<!doctype html>
<html lang="fr">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Contact</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdn.jsdelivr.net/npm/daisyui@5.0.35/dist/full.css" rel="stylesheet" type="text/css" />
    <style>
      html {
        scroll-behavior: smooth;
      }
    </style>
  </head>
  <body class="bg-gradient-to-r from-blue-600 via-purple-600 to-pink-600 text-white min-h-screen flex flex-col">
    <!-- NAVIGATION -->
    <nav class="p-4 bg-gray-900 bg-opacity-90 shadow-lg sticky top-0 z-10 backdrop-blur-md">
      <ul class="flex justify-center space-x-8 text-lg font-semibold text-white">
        <li><a href="index.html" class="hover:text-yellow-400 transition">Accueil</a></li>
        <li><a href="calculatrice.html" class="hover:text-yellow-400 transition">Calculatrice</a></li>
        <li><a href="contact.html" class="hover:text-yellow-400 transition">Contact</a></li>
      </ul>
    </nav>

    <!-- CONTENU PRINCIPAL -->
    <main class="flex-grow p-8 space-y-16 text-white">
      <section class="text-center space-y-4">
        <h1 class="text-5xl md:text-7xl font-extrabold drop-shadow">Contactez-moi</h1>
        <form action="mailto:eli.goldsztejn@epita.fr" method="GET" class="space-y-4">
          <input type="text" name="subject" placeholder="Sujet" class="input input-bordered w-full text-black" required />
          <textarea name="body" placeholder="Votre message" class="textarea textarea-bordered w-full text-black" required></textarea>
          <button type="submit" class="btn btn-primary">Envoyer</button>
        </form>
      </section>
      <section id="questionnaire" class="space-y-4 flex justify-center items-center">
        <div class="bg-white text-black p-6 rounded-lg shadow-lg w-full max-w-2xl">
          <!-- Le contenu du questionnaire sera injecté ici -->
        </div>
      </section>
      <p id="result-message" class="text-lg font-semibold hidden"></p>
    </main>

    <!-- FOOTER -->
    <footer class="p-4 bg-gray-900 bg-opacity-90 text-center text-sm text-white">
      © <script>document.write(new Date().getFullYear());</script> <a href="mailto:eli.goldsztejn@epita.fr" class="text-yellow-300 hover:underline">Eli Goldsztejn</a> – EPITA
    </footer>
    <script>
      let questionnaire = [];
      let currentQuestionIndex = 0;
      let reponses = '';

      // Chargement du fichier JSON
      fetch('./questions.json') // Assurez-vous que le fichier est dans le même répertoire
        .then((response) => {
          if (!response.ok) {
            throw new Error('Erreur lors du chargement du fichier questions.json');
          }
          return response.json();
        })
        .then((data) => {
          questionnaire = data;
          currentQuestionIndex = 0;
          reponses = '';
          renderQuestion();
          checkQuizCompletion(); // Vérifier l'état du quiz après le rendu
        })
        .catch((error) => {
          console.error('Erreur lors du chargement des questions :', error);
          document.getElementById('questionnaire').innerHTML =
            '<p class="text-red-500">Impossible de charger les questions. Veuillez réessayer plus tard.</p>';
        });

      function renderQuestion() {
        const questionContainer = document.getElementById('questionnaire').querySelector('div');
        questionContainer.innerHTML = '';

        if (currentQuestionIndex < questionnaire.length) {
          const question = questionnaire[currentQuestionIndex];
          const questionElement = document.createElement('div');
          questionElement.className = 'space-y-4 text-center'; // Centrer le texte et les réponses
          questionElement.innerHTML = `<p class='text-xl font-bold'>${question.qlabel}</p>`;

          // Vérification que question.reponses est un tableau
          if (Array.isArray(question.reponses)) {
            const buttonsContainer = document.createElement('div');
            buttonsContainer.className = 'flex flex-wrap justify-center gap-4'; // Centrer les boutons

            question.reponses.forEach((reponse) => {
              const button = document.createElement('button');
              button.textContent = reponse.rlabel;
              button.className = 'bg-blue-500 text-white px-4 py-2 rounded hover:bg-blue-700';
              button.onclick = () => handleAnswer(question.qid, reponse.rid);
              buttonsContainer.appendChild(button);
            });

            questionElement.appendChild(buttonsContainer);
          } else {
            questionElement.innerHTML += `<p class="text-red-500">Aucune réponse disponible pour cette question.</p>`;
          }

          questionContainer.appendChild(questionElement);
        } else if (reponses) {
          checkResult();
        } else {
          const resultMessage = document.getElementById('result-message');
          resultMessage.textContent = 'Veuillez répondre aux questions pour continuer.';
          resultMessage.classList.remove('hidden');
        }
      }

      function handleAnswer(qid, rid) {
        reponses += `A${qid}_${rid}`;
        currentQuestionIndex++;
        renderQuestion();
      }

      function checkResult() {
        const resultMessage = document.getElementById('result-message');
        const targetPage = `${reponses}.html`;

        fetch(targetPage, { method: 'HEAD' })
          .then((response) => {
            if (response.ok) {
              window.location.href = targetPage;
            } else {
              resultMessage.textContent = 'Suite à vos réponses, vous ne souhaitez pas être contacté.';
              resultMessage.classList.remove('hidden');
            }
          })
          .catch(() => {
            resultMessage.textContent = 'Suite à vos réponses, vous ne souhaitez pas être contacté.';
            resultMessage.classList.remove('hidden');
          });
      }

      // Masquer le formulaire de contact par défaut
      const contactForm = document.querySelector('form');
      contactForm.style.display = 'none';

      // Vérifier si le quiz a été répondu correctement
      function checkQuizCompletion() {
        const resultMessage = document.getElementById('result-message');
        const targetPage = `${reponses}.html`;

        fetch(targetPage, { method: 'HEAD' })
          .then((response) => {
            if (response.ok) {
              // Afficher le formulaire si le quiz est correct
              contactForm.style.display = 'block';
            } else {
              resultMessage.textContent = 'Veuillez répondre correctement au quiz pour accéder au formulaire de contact.';
              resultMessage.classList.remove('hidden');
            }
          })
          .catch(() => {
            resultMessage.textContent = 'Erreur lors de la vérification du quiz. Veuillez réessayer.';
            resultMessage.classList.remove('hidden');
          });
      }
    </script>
  </body>
</html>